paths:
  /api/v2/events/alarms/{id}/feedback:
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          format: uuid
        description: Alarm Event ID
    post:
      summary: Submit feedback for an incident
      tags:
        - Alarm Events
      produces:
        - application/json
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackSubmission'
      responses:
        201:
          description: Feedback successfully submitted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeedbackSubmission'
        400:
          description: Invalid request request body
        403:
          description: Unauthorized or device ID does not match incident
        404:
          description: Alarm event not found
  /api/v2/events/alarms:
    post:
      summary: Creates an Alarm Event
      tags:
        - Alarm Events
      produces:
        - application/json
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlarmInfo'
      responses:
        200:
          description: The ID of the created Alarm Event
          content:
            application/json:
              schema:
                type: string

    get:
      summary: Retrieves all Alarm Events according to the given filters.
      tags:
        - Alarm Events
      produces:
        - application/json
      parameters:
        - in: query
          name: locationId
          schema:
            type: string
        - in: query
          name: deviceId
          schema:
            type: string
        - in: query
          name: status
          schema:
            type: string
            example: gt:2
          description: 'Alarm event status. Multiple filters are allowed. Allowed operators: eq, lt, let, gt, get.'
        - in: query
          name: severity
          schema:
            type: string
            example: gt:2
          description: 'Alarm severity. Multiple filters are allowed. Allowed operators: eq, lt, let, gt, get.'
        - in: query
          name: lang
          schema:
            type: string
          description: Language
        - in: query
          name: page
          schema:
            type: number
          description: Page number
        - in: query
          name: size
          schema:
            type: number
          description: Page size
      responses:
        200:
          description: A list of matching Alarm Events.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlarmEventList'

  /api/v2/events/alarms/{id}:
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          format: uuid
        description: Alarm Event ID

    get:
      summary: Retrieves an Alarm Event by ID.
      tags:
        - Alarm Events
      produces:
        - application/json
      responses:
        200:
          description: The Alarm Event with the given ID.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlarmEvent'

    delete:
      summary: Deletes an Alarm Event by ID.
      tags:
        - Alarm Events
      produces:
        - application/json
      responses:
        200:
          description: The Alarm Event was successfully deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Empty'

  /api/v2/events/alarms/statistics:
    get:
      parameters:
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: deviceId
          schema:
            type: string
            format: uuid
        - in: query
          name: accountId
          schema:
            type: string
            format: uuid
        - in: query
          name: locationId
          schema:
            type: string
            format: uuid
      summary: Retrieves Alarm Event statistics.
      tags:
        - Alarm Events
      produces:
        - application/json
      responses:
        200:
          description: The Alarm Events statistics for the used filters.
          content:
            application/json:
              schema:
                type: object
                properties:
                  infoCount:
                    type: number
                  warningCount:
                    type: number
                  criticalCount:
                    type: number


components:
  schemas:
    AlarmInfo:
      type: object
      properties:
        macAddress:
          type: string
        alarmId:
          type: number
        telemetry:
          type: object
          properties:
            wf:
              type: number
            t:
              type: number
            p:
              type: number
            sw1:
              type: number
            sw2:
              type: number
            did:
              type: string
            ts:
              type: number
            sm:
              type: number
            f:
              type: number
            v:
              type: number
            rssi:
              type: number

    AlarmEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        alarm:
          type: object
          properties:
            id:
              type: number
        deviceId:
          type: string
          format: uuid
        status:
          type: string
        snoozeTo:
          type: string
          format: date-time
        locationId:
          type: string
          format: uuid
        systemMode:
          type: string
        updateAt:
          type: string
          format: date-time
        createAt:
          type: string
          format: date-time
        userFeedback:
          type: array
          items: 
            $ref: '#/components/schemas/UserFeedback'

    AlarmEventList:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AlarmEvent'
        page:
          type: number
        total:
          type: number
    UserFeedback:
      type: object
      required:
        - shouldAcceptAsNormal
        - cause
        - createdAt
      properties:
        cause:
          type: number
        shouldAcceptAsNormal:
          type: boolean
        plumbingFailure:
          type: number
        fixture:
          type: string
        causeOther:
          type: string
        plumbingFailureOther:
          type: string
        userId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
    FeedbackSubmission:
      type: object
      required:
        - deviceId
        - shouldAcceptAsNormal
        - cause
      properties:
        deviceId: 
          type: string
          format: uuid
        shouldAcceptAsNormal:
          type: boolean
        plumbingFailure:
          type: number
        fixture:
          type: string
        causeOther:
          type: string
        plumbingFailureOther:
          type: string